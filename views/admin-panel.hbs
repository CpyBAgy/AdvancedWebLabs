<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Панель управления - Два Холма</title>
  <link href="style.css" rel="stylesheet"/>
  <script src="js%20scripts/main.js" defer></script>
  <script src="js%20scripts/forms.js" defer></script>
  <script src="js%20scripts/addpet.js" defer></script>
  <script src="js%20scripts/services.js" defer></script>
  <script src="js%20scripts/appointment.js" defer></script>
  <script src="js%20scripts/admin-panel.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* Стили для табов */
    .tabs-container {
      margin-bottom: 30px;
    }

    .tabs {
      display: flex;
      background-color: #f5f5f5;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
      border: 1px solid #ddd;
    }

    .tab {
      flex: 1;
      text-align: center;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      color: #555;
      border-right: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .tab:last-child {
      border-right: none;
    }

    .tab.active {
      background-color: #2e7d32;
      color: white;
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Пользовательские стили для объединенной формы */
    .section-header {
      border-bottom: 2px solid #e8f5e9;
      padding-bottom: 15px;
      margin-bottom: 20px;
    }

    .form-container {
      background-color: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    /* Стили для списков */
    .entity-list {
      margin-top: 30px;
      border-top: 1px solid #eee;
      padding-top: 20px;
    }

    .entity-list h3 {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .entity-list ul {
      list-style: none;
      padding: 0;
    }

    .entity-list li {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
    }

    .entity-list li:hover {
      transform: translateX(5px);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .entity-info {
      flex: 1;
    }

    .entity-actions {
      display: flex;
      gap: 10px;
    }

    .entity-actions button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
      transition: all 0.2s ease;
    }

    .edit-btn {
      color: #1976d2;
    }

    .delete-btn {
      color: #e53935;
    }

    .entity-actions button:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    /* Стили для редактирования в строке */
    .edit-form {
      background-color: #f0f7f0;
      padding: 15px;
      border-radius: 8px;
      margin-top: 10px;
    }

    .edit-form button {
      background-color: #2e7d32;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }

    /* Анимация обновления */
    @keyframes highlight {
      0% { background-color: #c8e6c9; }
      100% { background-color: #f9f9f9; }
    }

    .highlight {
      animation: highlight 2s ease;
    }
  </style>
</head>
<body data-user-id="{{user.id}}">

{{> header}}
{{> navbar}}

<div class="page-banner form-banner">
  <h2>Панель управления</h2>
  <p>Добавляйте и редактируйте животных, услуги и записи на прием</p>
</div>

<main class="main-section">
  <!-- Уведомление -->
  <div id="notification" class="notification" style="display: none;"></div>

  <!-- Табы для переключения между разделами -->
  <div class="tabs-container">
    <div class="tabs">
      <div class="tab active" data-tab="animals-tab">
        <i class="fas fa-paw"></i> Животные
      </div>
      <div class="tab" data-tab="services-tab">
        <i class="fas fa-concierge-bell"></i> Услуги
      </div>
      <div class="tab" data-tab="appointments-tab">
        <i class="fas fa-calendar-check"></i> Записи
      </div>
    </div>

    <!-- Контент табов -->

    <!-- Таб Животные -->
    <div class="tab-content active" id="animals-tab">
      <div class="dashboard-container">
        <section class="form-section">
          <div class="section-header">
            <h3><i class="fas fa-plus-circle"></i> <span id="formTitle">Добавление животного</span></h3>
            <div class="status-indicator" id="formStatus">
              <span class="status-dot"></span>
              <span class="status-text">Режим добавления</span>
            </div>
          </div>

          <form id="animalForm" class="styled-form">
            <div class="form-row">
              <div class="form-group">
                <label for="name"><i class="fas fa-signature"></i> Имя животного</label>
                <input type="text" id="name" placeholder="Например: Гоша" required>
              </div>

              <div class="form-group">
                <label for="type"><i class="fas fa-paw"></i> Вид животного</label>
                <select id="type" required>
                  <option value="" disabled selected>Выберите вид</option>
                  <optgroup label="Рептилии">
                    <option value="Зеленая игуана">Зеленая игуана</option>
                    <option value="Йеменский хамелеон">Йеменский хамелеон</option>
                    <option value="Бородатая агама">Бородатая агама</option>
                    <option value="Королевский питон">Королевский питон</option>
                    <option value="Красноухая черепаха">Красноухая черепаха</option>
                  </optgroup>
                  <optgroup label="Птицы">
                    <option value="Сине-жёлтый ара">Сине-жёлтый ара</option>
                    <option value="Африканский серый попугай">Африканский серый попугай</option>
                    <option value="Тукан Токо">Тукан Токо</option>
                    <option value="Венценосный голубь">Венценосный голубь</option>
                  </optgroup>
                  <optgroup label="Млекопитающие">
                    <option value="Капуцин">Капуцин</option>
                    <option value="Одногорбый верблюд">Одногорбый верблюд</option>
                    <option value="Сахарная сумчатая летяга">Сахарная сумчатая летяга</option>
                  </optgroup>
                  <optgroup label="Насекомые и паукообразные">
                    <option value="Розовый птицеед">Розовый птицеед</option>
                    <option value="Императорский скорпион">Императорский скорпион</option>
                    <option value="Мадагаскарский таракан">Мадагаскарский таракан</option>
                  </optgroup>
                  <option value="other">Другой (укажите)</option>
                </select>
                <input type="text" id="customType" placeholder="Укажите вид животного" style="display: none; margin-top: 10px;">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="age"><i class="fas fa-birthday-cake"></i> Возраст</label>
                <div class="input-with-suffix">
                  <input type="number" id="age" min="0" step="0.1" placeholder="Возраст" required>
                  <select id="ageUnit">
                    <option value="years">лет</option>
                    <option value="months">месяцев</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label for="gender"><i class="fas fa-venus-mars"></i> Пол</label>
                <select id="gender">
                  <option value="unknown" selected>Неизвестно</option>
                  <option value="male">Самец</option>
                  <option value="female">Самка</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="description"><i class="fas fa-align-left"></i> Описание</label>
              <textarea id="description" rows="3" placeholder="Особенности, характер, состояние здоровья и т.д."></textarea>
            </div>

            <div class="form-buttons">
              <button type="submit" id="submitButton" class="primary-button">
                <i class="fas fa-plus"></i> Добавить
              </button>
              <button type="button" id="cancelButton" class="secondary-button">
                <i class="fas fa-times"></i> Отменить
              </button>
            </div>
          </form>
        </section>

        <section class="stats-section">
          <h3><i class="fas fa-chart-pie"></i> Статистика</h3>
          <div class="stats-cards">
            <div class="stat-card" id="totalAnimals">
              <div class="stat-icon"><i class="fas fa-paw"></i></div>
              <div class="stat-info">
                <h4>Всего животных</h4>
                <p class="stat-number">0</p>
              </div>
            </div>

            <div class="stat-card" id="reptileCount">
              <div class="stat-icon"><i class="fas fa-dragon"></i></div>
              <div class="stat-info">
                <h4>Рептилии</h4>
                <p class="stat-number">0</p>
              </div>
            </div>

            <div class="stat-card" id="birdCount">
              <div class="stat-icon"><i class="fas fa-feather-alt"></i></div>
              <div class="stat-info">
                <h4>Птицы</h4>
                <p class="stat-number">0</p>
              </div>
            </div>

            <div class="stat-card" id="mammalCount">
              <div class="stat-icon"><i class="fas fa-horse"></i></div>
              <div class="stat-info">
                <h4>Млекопитающие</h4>
                <p class="stat-number">0</p>
              </div>
            </div>

            <div class="stat-card" id="insectCount">
              <div class="stat-icon"><i class="fas fa-spider"></i></div>
              <div class="stat-info">
                <h4>Насекомые</h4>
                <p class="stat-number">0</p>
              </div>
            </div>

            <div class="stat-card" id="otherCount">
              <div class="stat-icon"><i class="fas fa-question-circle"></i></div>
              <div class="stat-info">
                <h4>Другие</h4>
                <p class="stat-number">0</p>
              </div>
            </div>
          </div>

          <div class="chart-container">
            <div class="chart-placeholder" id="chartPlaceholder">
              <i class="fas fa-chart-bar"></i>
              <p>Диаграмма распределения по типам</p>
            </div>
          </div>
        </section>
      </div>

      <section class="table-section">
        <div class="table-header">
          <h3><i class="fas fa-list"></i> Список животных</h3>
          <div class="table-tools">
            <div class="search-container">
              <input type="text" id="searchAnimal" placeholder="Поиск по имени или виду...">
              <i class="fas fa-search"></i>
            </div>
            <div class="filter-dropdown">
              <button class="dropdown-button" id="filterButton">
                <i class="fas fa-filter"></i> Фильтр
              </button>
              <div class="dropdown-content" id="filterDropdown">
                <div class="filter-option">
                  <input type="checkbox" id="filterReptiles" value="reptile" checked>
                  <label for="filterReptiles">Рептилии</label>
                </div>
                <div class="filter-option">
                  <input type="checkbox" id="filterBirds" value="bird" checked>
                  <label for="filterBirds">Птицы</label>
                </div>
                <div class="filter-option">
                  <input type="checkbox" id="filterMammals" value="mammal" checked>
                  <label for="filterMammals">Млекопитающие</label>
                </div>
                <div class="filter-option">
                  <input type="checkbox" id="filterInsects" value="insect" checked>
                  <label for="filterInsects">Насекомые</label>
                </div>
                <!-- Кнопки управления фильтрами -->
                <div class="filter-actions">
                  <button id="selectAllFilters" class="filter-action-btn select-all">Выбрать все</button>
                  <button id="clearAllFilters" class="filter-action-btn clear-all">Снять все</button>
                </div>
              </div>
            </div>
            <div class="sort-dropdown">
              <button class="dropdown-button" id="sortButton">
                <i class="fas fa-sort"></i> Сортировка
              </button>
              <div class="dropdown-content" id="sortDropdown">
                <div class="sort-option">
                  <input type="radio" name="sortOption" id="sortName" value="name" checked>
                  <label for="sortName">По имени</label>
                </div>
                <div class="sort-option">
                  <input type="radio" name="sortOption" id="sortType" value="type">
                  <label for="sortType">По виду</label>
                </div>
                <div class="sort-option">
                  <input type="radio" name="sortOption" id="sortAge" value="age">
                  <label for="sortAge">По возрасту</label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="animalTypes" class="type-tags"></div>

        <div class="table-container">
          <table id="animalTable" class="data-table">
            <thead>
            <tr>
              <th>Имя</th>
              <th>Вид</th>
              <th>Возраст</th>
              <th>Пол</th>
              <th>Описание</th>
              <th>Действия</th>
            </tr>
            </thead>
            <tbody>
            <!-- Записи будут добавлены с помощью JavaScript -->
            </tbody>
          </table>

          <!-- Сообщение при отсутствии животных -->
          <div id="emptyTable" class="empty-table-message" style="display: none;">
            <i class="fas fa-paw"></i>
            <p>Список животных пуст. Добавьте первое животное с помощью формы выше.</p>
          </div>
        </div>
      </section>
    </div>

    <!-- Таб Услуги -->
    <div class="tab-content" id="services-tab">
      <div class="form-container">
        <div class="section-header">
          <h3><i class="fas fa-plus-circle"></i> Добавление услуги</h3>
        </div>

        <form id="serviceForm" class="styled-form">
          <div class="form-row">
            <div class="form-group">
              <label for="serviceName"><i class="fas fa-tag"></i> Название услуги</label>
              <input type="text" id="serviceName" name="name" placeholder="Например: Ветеринарный осмотр" required>
            </div>

            <div class="form-group">
              <label for="servicePrice"><i class="fas fa-ruble-sign"></i> Стоимость</label>
              <input type="number" id="servicePrice" name="price" min="0" step="100" placeholder="Укажите стоимость" required>
            </div>
          </div>

          <div class="form-group">
            <label for="serviceDescription"><i class="fas fa-align-left"></i> Описание услуги</label>
            <textarea id="serviceDescription" name="description" rows="3" placeholder="Подробное описание услуги..." required></textarea>
          </div>

          <div class="form-buttons">
            <button type="submit" class="primary-button">
              <i class="fas fa-plus"></i> Добавить услугу
            </button>
          </div>
        </form>

        <div class="entity-list">
          <h3><i class="fas fa-list"></i> Список услуг</h3>
          <ul id="servicesList">
            <!-- Услуги будут добавлены через JavaScript -->
          </ul>
        </div>
      </div>
    </div>

    <!-- Таб Записи -->
    <div class="tab-content" id="appointments-tab">
      <div class="form-container">
        <div class="section-header">
          <h3><i class="fas fa-calendar-plus"></i> Добавление записи</h3>
        </div>

        <form id="appointmentForm" class="styled-form">
          <div class="form-row">
            <div class="form-group">
              <label for="pet"><i class="fas fa-paw"></i> Питомец</label>
              <select name="petId" id="pet" required>
                <option value="" disabled selected>Выберите питомца</option>
                {{#each pets}}
                  <option value="{{this.id}}">{{this.name}}</option>
                {{/each}}
              </select>
            </div>

            <div class="form-group">
              <label for="service"><i class="fas fa-concierge-bell"></i> Услуга</label>
              <select name="serviceId" id="service" required>
                <option value="" disabled selected>Выберите услугу</option>
                {{#each services}}
                  <option value="{{this.id}}">{{this.name}}</option>
                {{/each}}
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="date"><i class="fas fa-calendar-alt"></i> Дата и время</label>
            <input type="datetime-local" name="date" id="date" required>
          </div>

          <div class="form-buttons">
            <button type="submit" class="primary-button">
              <i class="fas fa-plus"></i> Добавить запись
            </button>
          </div>
        </form>

        <div class="entity-list">
          <h3><i class="fas fa-clipboard-list"></i> Список записей</h3>
          <ul id="appointmentsList">
            <!-- Записи будут добавлены через JavaScript -->
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Модальное окно для подтверждения удаления -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h4><i class="fas fa-exclamation-triangle"></i> Подтверждение удаления</h4>
        <span class="close-modal">&times;</span>
      </div>
      <div class="modal-body">
        <p>Вы уверены, что хотите удалить <span id="deleteItemName">это животное</span> из базы данных?</p>
        <p class="warning-text">Это действие невозможно отменить.</p>
      </div>
      <div class="modal-footer">
        <button id="cancelDelete" class="secondary-button">Отмена</button>
        <button id="confirmDelete" class="danger-button">Удалить</button>
      </div>
    </div>
  </div>
</main>

{{> footer}}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Переключение табов
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
      tab.addEventListener('click', function() {
        // Удаляем активный класс у всех табов и контента
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));

        // Добавляем активный класс к выбранному табу
        this.classList.add('active');

        // Показываем соответствующий контент
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });

    // Инициализация графика для животных
    const chartContainer = document.getElementById('chartPlaceholder');
    if (chartContainer) {
      const reptileCount = parseInt(document.querySelector('#reptileCount .stat-number').textContent) || 0;
      const birdCount = parseInt(document.querySelector('#birdCount .stat-number').textContent) || 0;
      const mammalCount = parseInt(document.querySelector('#mammalCount .stat-number').textContent) || 0;

      chartContainer.innerHTML = '<canvas id="animalChart" width="400" height="250"></canvas>';

      const ctx = document.getElementById('animalChart').getContext('2d');
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Рептилии', 'Птицы', 'Млекопитающие'],
          datasets: [{
            label: 'Количество животных',
            data: [reptileCount, birdCount, mammalCount],
            backgroundColor: [
              'rgba(76, 175, 80, 0.7)',
              'rgba(33, 150, 243, 0.7)',
              'rgba(255, 152, 0, 0.7)'
            ],
            borderColor: [
              'rgba(76, 175, 80, 1)',
              'rgba(33, 150, 243, 1)',
              'rgba(255, 152, 0, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'Распределение по типам животных'
            }
          }
        }
      });
    }

    // Обработчик события для форм
    const userId = "{{user.id}}";

    // Инициализация переменных для хранения текущих элементов
    let currentDeleteItem = null;
    let currentDeleteType = 'animal';

    // Обработчик для подтверждения удаления
    document.getElementById('confirmDelete').addEventListener('click', function() {
      if (currentDeleteItem && currentDeleteType) {
        switch(currentDeleteType) {
          case 'animal':
            deleteAnimal(currentDeleteItem);
            break;
          case 'service':
            deleteService(currentDeleteItem);
            break;
          case 'appointment':
            deleteAppointment(currentDeleteItem);
            break;
        }

        document.getElementById('deleteModal').style.display = 'none';
        currentDeleteItem = null;
      }
    });

    // Обработчики для закрытия модального окна
    document.getElementById('cancelDelete').addEventListener('click', function() {
      document.getElementById('deleteModal').style.display = 'none';
    });

    document.querySelector('.close-modal').addEventListener('click', function() {
      document.getElementById('deleteModal').style.display = 'none';
    });

    window.addEventListener('click', function(event) {
      const modal = document.getElementById('deleteModal');
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });

    // Функция для показа модального окна удаления
    function showDeleteConfirmation(id, name, type) {
      currentDeleteItem = id;
      currentDeleteType = type;

      const itemNameElement = document.getElementById('deleteItemName');

      switch(type) {
        case 'animal':
          itemNameElement.textContent = `животное "${name}"`;
          break;
        case 'service':
          itemNameElement.textContent = `услугу "${name}"`;
          break;
        case 'appointment':
          itemNameElement.textContent = `запись "${name}"`;
          break;
      }

      document.getElementById('deleteModal').style.display = 'flex';
    }

    // Функции для обработки данных
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.style.display = 'block';

      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
          notification.style.display = 'none';
          notification.style.opacity = '1';
        }, 300);
      }, 3000);
    }

    // Эти функции будут реализованы в соответствующих JS скриптах
    function deleteAnimal(id) {
      // Реализация из js/forms.js
      console.log('Удаление животного с ID:', id);
    }

    function deleteService(id) {
      // Реализация из js/services.js
      console.log('Удаление услуги с ID:', id);
    }

    function deleteAppointment(id) {
      // Реализация из js/appointment.js
      console.log('Удаление записи с ID:', id);
    }
  });
</script>
</body>
</html>